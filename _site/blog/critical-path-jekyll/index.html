<!DOCTYPE html>
<html lang="en" class="online">

  <head lang="en">
  <script>
    // https://github.com/filamentgroup/loadCSS
    !function(e){"use strict"
    var n=function(n,t,o){function i(e){return f.body?e():void setTimeout(function(){i(e)})}var d,r,a,l,f=e.document,s=f.createElement("link"),u=o||"all"
    return t?d=t:(r=(f.body||f.getElementsByTagName("head")[0]).childNodes,d=r[r.length-1]),a=f.styleSheets,s.rel="stylesheet",s.href=n,s.media="only x",i(function(){d.parentNode.insertBefore(s,t?d:d.nextSibling)}),l=function(e){for(var n=s.href,t=a.length;t--;)if(a[t].href===n)return e()
    setTimeout(function(){l(e)})},s.addEventListener&&s.addEventListener("load",function(){this.media=u}),s.onloadcssdefined=l,l(function(){s.media!==u&&(s.media=u)}),s}
    "undefined"!=typeof exports?exports.loadCSS=n:e.loadCSS=n}("undefined"!=typeof global?global:this)
  </script>
  <!-- Static Meta Tags -->
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="copyright" content="&copy 2018 " />
  <meta name="description" content="Site description" />
  <meta name="robots" content="index, follow"  />
  <link rel="canonical" href="https://joshvogt.co" />
  <link rel="manifest" href="/manifest.webmanifest">
  <meta name="theme-color" content="#0073bd">
  <link rel="apple-touch-icon" sizes="180x180" href="/static-assets/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/static-assets/images/icon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/static-assets/images/icon-16x16.png">
  <link rel="mask-icon" href="static-assets/images/safari-pinned-tab.svg" color="#5bbad5">
  <link rel="icon" href="favicon.ico">
  <link rel="alternate" type="application/rss+xml" title="Josh Vogt RSS" href="/feed.xml">
  <title>Critical Path CSS and Jekyll</title>


  <!-- Meta tags for social media -->
  <meta property="og:locale" content="en" />
  <meta property="og:type" content="website" />
  <meta property="og:title" content="Critical Path CSS and Jekyll"  />
  <meta property="og:url" content="https://joshvogt.co/blog/critical-path-jekyll/"  />
  <meta property="og:site_name" content="Josh Vogt - Web Developer"  />
  <meta property="og:image" content="static-assets/images/icon-512x512.png" />
  <meta property="og:description" content="Site description"  />
  <meta property="twitter:card" content="summary" />
  <meta property="twitter:title" content="Critical Path CSS and Jekyll" />
  <meta property="twitter:image" content="https://joshvogt.co//static-assets/images/icon-512x512.png" />
  <meta property="twitter:site" content="@jshvgt"  />
  <meta property="twitter:creator" content="@jshvgt"  />
  <meta property="twitter:description" content="site description"  />
  <link rel="pingback" href="https://webmention.io//xmlrpc" />
  <link rel="webmention" href="https://webmention.io//webmention" />
  <link rel="authorization_endpoint" href="https://indieauth.com/auth">
  

  

  

  

  <style>
  *{box-sizing:border-box;color:inherit;font-family:inherit;line-height:inherit}html,body{margin:0;padding:0;height:100%;width:100%;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol";background:#141619;color:#fdf9d8}body{display:-ms-flexbox;display:flex;-ms-flex-flow:column nowrap;flex-flow:column nowrap;-ms-flex-pack:justify;justify-content:space-between}main{-ms-flex-positive:1;flex-grow:1;display:block;max-width:100%;width:100%;height:auto;position:static}main:focus{outline:none}footer{display:none}.container{display:block;width:inherit;margin:0 auto;position:relative}.block{max-width:1240px;margin:0 auto}a{color:#c2e0ff;cursor:pointer;text-decoration:underline;text-decoration-skip:ink;font-weight:500;-webkit-text-decoration-style:double;-moz-text-decoration-style:double;text-decoration-style:double;text-decoration-color:#c2e0ff}a:focus,a:hover{text-decoration:inherit;color:#0073BD;outline:1px dashed #fdf9d8;background:#fdf9d8}img{max-width:100%}.highlighter-rouge{margin-top:1rem}.highlight{padding:.5rem;line-height:1.6;background:#0073BD;color:#fff;font-size:16px;font-size:1rem;overflow:auto;margin:10px}.disabled-link{cursor:not-allowed;color:#f7fafb}.visuallyhidden{clip:rect(1px, 1px, 1px, 1px);height:1px;overflow:hidden;position:absolute;width:1px}[href="#main"]{position:absolute;top:0;right:110%}[href="#main"]:focus{right:auto}.global-footer{height:100px;border-top:0.2rem solid #25282e}button,.primary-cta{margin-top:1rem;border:1px solid #141619;padding:.5rem 1rem;border-radius:4px;background:#f7fafb;font-size:16px;font-size:1rem;color:#0073BD}button[disabled],.primary-cta[disabled]{background:#fdf9d8;color:#141619}.global-footer{min-height:130px;padding:.5rem}.indieweb-social{list-style:none;margin:0;padding:20px;display:grid;grid-template-columns:repeat(auto-fill, minmax(100px, 1fr))}.indieweb-social li+li{margin-top:0}.footer-bio{max-width:460px;padding:20px}.header-container{-ms-flex:0 0 auto;flex:0 0 auto;height:60px;width:100vw;border-bottom:0.15rem solid #525967;display:-ms-flexbox;display:flex;-ms-flex-align:center;align-items:center;-ms-flex-pack:justify;justify-content:space-between;padding:0 10px}.header-container h1{font-size:17.6px;font-size:1.1rem;font-weight:600}.header-container .home-link{display:inline-block;white-space:nowrap;line-height:60px;height:100%}.header-container .site-logo{width:55px;float:left;margin-right:.5rem}.header-container .header-links{margin:0}@media screen and (min-width: 30rem){.header-links{margin:0 3rem}}

    .post-container{margin-top:4rem}.post{max-width:800px;padding:10px 20px;margin:0 auto}.post-container p{font-size:18px;font-size:1.125rem;line-height:1.4;max-width:640px}.global-footer{display:block}li+li{margin-top:.5rem}.mentions-list{list-style:none;margin:0;padding:0}.mentions-list li{border-left:4px solid #fdf9d8}.mentions-list li:nth-of-type(odd){background:#f7fafb}.mention-item{padding:.5rem 0}.mention-item cite{display:inherit;margin:.8125rem .4rem}.mention-form fieldset{border:none;padding:0 0 20px 0;margin-top:30px}.mention-form input[type="url"]{width:75%;margin-right:2%;border:1px solid #25282e;padding:8px;border-radius:4px}.mention-form input:required:empty{border:1px solid #25282e}

  
  </style>

  
  <script>
    loadCSS("/static-assets/css/new-base.css");
  </script>
  

 

</head>


  <body>
    <header class="header-container">
  <h1>
    <a class="home-link" href="/">
    Josh Vogt
    </a>
</h1>

  <nav class="header-links">
    <a href="/posts/">Posts</a>
    <a href="/notes/">Notes</a>
    <a href="/links/">Links</a>
  </nav>
</header>


    <main id="main" tabindex="0">
      <article class="post h-entry">
  <header>
    <h1 class="p-name">Critical Path CSS and Jekyll</h1>
    <p>Published by <a class="p-author h-card" href="https://joshvogt.co">Josh Vogt</a>
     on <time class="dt-published" datetime="2017-03-11 22:16:01 +0000">March 11, 2017</time></p>
     <p class="p-summary"><em>Four different ways to inline critical CSS on Jekyll sites.</em></p>
     <p>
       <a class="u-url" href="https://joshvogt.co/blog/critical-path-jekyll/">Permalink</a>
     </p>
  </header>
  <div class="e-content post-container">
    <p>
  When creating landing pages, the same critical CSS wont always include the CSS you need to render the page. If you know that your above the fold content is going to be similar you can use a simpler, more generic approach.
</p>

<h2>The easy way.</h2>
<p>
  Add a file in Jekyll's <code>_includes</code> folder called <code>critical.css</code>.
</p>
<p>
  In the <code>head</code> of you document include the following snippet. This will include all the CSS in your <code>critical.css</code> in the <code>head</code> of each page.
</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">  <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
  
    <span class="p">{</span><span class="err">%</span> <span class="err">include</span> <span class="err">critical.css</span> <span class="err">%</span><span class="p">}</span>
    
  <span class="nt">&lt;/style&gt;</span></code></pre></figure>

<h2>The easy Sass way.</h2>
<p>
  Use <code>Scssify</code> to inline critical Sass.</p>
</p>
<p>
  If you prefer to write Sass you can still use the <code>_includes</code> folder to inline your critical CSS. You'll need to use Liquid's <code>capture</code> tag and Jekyll's <code>scssify</code> filter. The <code>scssify</code> filter respects the Sass settings in Jekyll's <code>_config.yml</code> file so if it's set to compress Sass it will compress the critical CSS in the <code>head</code> of the document.
</p>
<p>
  Create a Sass file in Jekyll's <code>_includes</code> folder and write some Sass. In the <code>head</code> of your document include the following snippet.
</p>

<figure class="highlight"><pre><code class="language-html" data-lang="html">  <span class="nt">&lt;style </span><span class="na">type=</span><span class="s">"text/css"</span><span class="nt">&gt;</span>
  
    <span class="p">{</span><span class="err">%</span> <span class="err">capture</span> <span class="err">critical</span> <span class="err">%</span><span class="p">}</span>
      <span class="p">{</span><span class="err">%</span> <span class="err">include</span> <span class="err">style.scss</span> <span class="err">%</span><span class="p">}</span>
    <span class="p">{</span><span class="err">%</span> <span class="err">endcapture</span> <span class="err">%</span><span class="p">}</span>

    <span class="p">{</span><span class="err">{</span> <span class="err">critical</span> <span class="err">|</span> <span class="err">scssify</span> <span class="p">}</span><span class="err">}</span>
  
  <span class="nt">&lt;/style&gt;</span></code></pre></figure>

<p>
   Liquid's <a href="https://help.shopify.com/themes/liquid/tags/variable-tags#capture">capture tag</a> will store the string (in this case the Sass written the aforementioned file) as a variable that can be referenced later. This snippet: <code>{{ critical | scssify }}</code> will take the captured Sass and convert it CSS that is inlined in the <code>head</code> of the document. If the <code>_config.yml</code> is configured to compress Sass the inlined critical CSS will also be compressed.
</p>

<h2>The slightly more complex way that is way more fun.</h2>
<p>
  Keep all of your Sass files in the same place and use Gulp (or any task runner) to output compiled CSS into the <code>_includes</code> folder.
</p>

<p>
  You don't need to split up the Sass files into the <code>_includes</code> folder and the folder you keep the rest of the sites static assets. Instead you can have a task runner process the critical Sass files and place them in the correct folder for Jekyll to process at build time.
</p>

<p>
  This Gulp task will compile all the Sass files in the specified folder and drop them in Jekyll's <code>_includes</code> folder. When Jekyll compiles the site it will follow the same process described above.
</p>

<figure class="highlight"><pre><code class="language-javascript" data-lang="javascript"><span class="nx">gulp</span><span class="p">.</span><span class="nx">task</span><span class="p">(</span><span class="s1">'critical'</span><span class="p">,</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">gulp</span><span class="p">.</span><span class="nx">src</span><span class="p">(</span><span class="s1">'src/sass/critical/*.scss'</span><span class="p">)</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">sass</span><span class="p">({</span>
            <span class="na">outputStyle</span><span class="p">:</span> <span class="s1">'compressed'</span><span class="p">,</span>
            <span class="na">includePaths</span><span class="p">:</span> <span class="p">[</span><span class="s1">'scss'</span><span class="p">]</span>
        <span class="p">}))</span>
        <span class="p">.</span><span class="nx">pipe</span><span class="p">(</span><span class="nx">gulp</span><span class="p">.</span><span class="nx">dest</span><span class="p">(</span><span class="s1">'_includes/critical'</span><span class="p">));</span>
<span class="p">});</span></code></pre></figure>

<h2>The way to create page specific critical CSS.</h2>
<p>
  Marketing sites or landing pages might need their own critical CSS.
</p>

<p>
  If you have a simple blog or a marketing site that doesn't have a lot of visual changes you can probably get away with a single critical CSS implementation. But if you're creating a series of complex landing pages the critical CSS that works great on Page One might be utterly useless on Page Two. Using Jekyll's Front Matter you can create page specific critical CSS with a little extra code.
</p>

<p>
  In Page A's Front Matter create a new variable called <em>critical</em> and assign it a value that will match the name of the compiled critical CSS file. So something like <em>pageOneCritical.css</em>.
</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="o">---</span>
<span class="ss">layout: </span><span class="n">page</span>
<span class="ss">critical: </span><span class="n">pageOneCritical</span><span class="p">.</span><span class="nf">css</span>
<span class="o">---</span></code></pre></figure>

<p>
You'll now need to modify the <code>head</code> of the template to react to this bit of Front Matter. You can use an <em>if</em> statement to look for the existence of the critical Front Matter and add it the the page when Jekyll compiles the site.
</p>

<figure class="highlight"><pre><code class="language-ruby" data-lang="ruby">  
  <span class="p">{</span><span class="sx">% if </span><span class="n">page</span><span class="p">.</span><span class="nf">critical</span> <span class="sx">%}
   {% capture critical %}</span>
    <span class="p">{</span><span class="sx">% include </span><span class="n">critical</span><span class="o">/</span><span class="p">{{</span> <span class="n">page</span><span class="p">.</span><span class="nf">critical</span> <span class="p">}}</span> <span class="o">%</span><span class="p">}</span>
   <span class="p">{</span><span class="sx">% endcapture </span><span class="o">%</span><span class="p">}</span>
  <span class="p">{</span><span class="sx">% endif </span><span class="o">%</span><span class="p">}</span>

  <span class="o">&lt;</span><span class="n">style</span><span class="o">&gt;</span>
    <span class="p">{{</span> <span class="n">critical</span> <span class="p">}}</span>
  <span class="o">&lt;</span><span class="sr">/style&gt;
  </span></code></pre></figure>

<p>
  This will tell Jekyll to check for the existence of the critical variable in the page's Front Matter. If it exists it will capture the compiled CSS that the Gulp task dropped in the <code>_includes</code> folder and inline in the <code>&lt;style></code> element.
</p>

<p>

</p>Corrections or comments can be directed to my twitter account <a href="https://twitter.com/jshvgt">@jshvgt</a>.</p>

  </div>


  <aside class="post-webmentions" hidden>
    <h2>Mentions</h2>
    <ul class="mentions-list" id="webmentions-container">

    </ul>
  </aside>

  <div class="mention-response">
    <h4>Send a response</h4>
    <p>
      If you've written a response to this post enter the url of your post and send it over.
    </p>
    <form class="mention-form" method="post" action="https://webmention.io/joshvogt.netlify.com/webmention">
      <fieldset>
          <label for="url-mention">Add your response:</label>
          <input id="url-mention" type="url" name="source" required placeholder="https://yourdomain/response" />
          <input type="hidden" name="target" value="https://joshvogt.co/blog/critical-path-jekyll/"  />
          <button>Send webmention</button>
      </fieldset>
    </form>
  </div>
</article>



<template id="mention-tmpl">
  <li>
    <blockquote class="mention-item">
      <div class="mention-reply-content"></div>
      <cite>
        <span class="mention-reply-author"></span>
        <a class="mention-reply-link"></a>
      </cite>
    </div>
  </li>
</template>

<script>
  var mainScript = document.createElement('script');
  mainScript.src = '/static-assets/js/posts.js';
  document.body.appendChild(mainScript);
</script>


<input id="page-path" type="hidden" value="https://joshvogt.co/blog/critical-path-jekyll/" />
<input id="page-id" type="hidden" value="51bc6a064fc32475e84f45fc0b269cfc" /> 
    </main>

    <footer class="global-footer" role="contentinfo">
  <div class="indieweb-card h-card">
    <ul class="indieweb-social">
     
       <li>
         <a href="https://twitter.com/jshvgt" rel="me" class="u-url;">
           twitter
         </a>
       </li>
     
       <li>
         <a href="https://github.com/dumaurier" rel="me" class="u-url;">
           github
         </a>
       </li>
     
       <li>
         <a href="mailto:joshvogt@gmail.com" rel="me" class="u-email">
           email
         </a>
       </li>
     
       <li>
         <a href="http://joshvogt.netlify.com" rel="me" class="u-url">
           my site
         </a>
       </li>
     
   </ul>

    
    <p class="p-note footer-bio">
      Front-end developer. Focused on performance, accessibility and standards. 
    </p>
    <small>&copy; 2018 Josh Vogt. all mistakes are my own.</small>
  </div>


</footer>




<script>
// Ye Olde Service Worker----------------------------------------------
(function() {
 'use strict';
  if ('serviceWorker' in navigator) {
   navigator.serviceWorker
   .register('/sw.js',{
    scope: '/'
   })
   .then(function() { console.log('Service Worker Registered');  });
  }
 })();
</script>


  </body>
</html>
